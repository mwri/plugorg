// Package: plugorg v1.0.0 (built 2017-10-05 15:47:08)
// Copyright: (C) 2017 Michael Wright <mjw@methodanalysis.com>
// License: MIT

"use strict";!function(){var t=void 0;if("undefined"!=typeof module&&void 0!==module.exports){var e=require("taffydb");t=e.taffy}else t=window.TAFFY;var n=function(){var e=function(e){if(void 0===e&&(e={}),this.pltypes=t(),this.plugins=t(),this.add_type(o),e.types)for(var n=0;n<e.types.length;n++)this.add_type(e.types[n]);if(e.plugins)for(var r=0;r<e.plugins.length;r++)this.add_plugin(e.plugins[r])};return e.prototype.add_type=function(t,e){var n="string"==typeof t?require(t):t,o=n.prototype.po_name();if(this.pltypes({name:o}).get().length>0)throw new Error("name clash, or already added");for(var r="function"==typeof n.prototype.po_attribs?n.prototype.po_attribs():{},i=new n(e),p={inst:i,name:o},l=Object.keys(r),a=0;a<l.length;a++){if("name"===l[a]||"type"===l[a])throw new Error('illegal attribute "'+l[a]+'"');p[l[a]]=r[l[a]]}return this.pltypes.insert(p),i},e.prototype.add_plugin=function(t,e){var n="string"==typeof t?require(t):t,o=n.prototype.po_name(),r="function"==typeof n.prototype.po_attribs?n.prototype.po_attribs():{},i="function"==typeof n.prototype.po_type?n.prototype.po_type():"default";if(this.plugins({type:i,name:o}).get().length>0)throw new Error('name clash, or already added (name "'+o+'" type "'+i+'")');var p=this.get_type({name:i});if(void 0===p)throw new Error('plugin type "'+i+'" not known');var l=new n(p,e);if(!0!==("function"!=typeof p.po_validplugin||p.po_validplugin(l)))throw new Error('plugin type "'+p.po_name()+'" validation failed');for(var a={inst:l,name:o,type:i},u=Object.keys(r),s=0;s<u.length;s++){if("name"===u[s]||"type"===u[s])throw new Error('illegal attribute "'+u[s]+'"');a[u[s]]=r[u[s]]}return this.plugins.insert(a),l},e.prototype.get_type=function(t){var e=this.get_types(t);if(0!==e.length){if(1===e.length)return e[0];throw new Error("multiple results, not allowed")}},e.prototype.get_types=function(t){return this.pltypes(t).distinct("inst")},e.prototype.get_plugin=function(t){var e=this.get_plugins(t);if(0!==e.length){if(1===e.length)return e[0];throw new Error("multiple results, now allowed")}},e.prototype.get_plugins=function(t){return this.plugins(t).distinct("inst")},e}(),o=function(){var t=function(){};return t.prototype.po_name=function(){return"default"},t}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=n:window.plugorg=n}();